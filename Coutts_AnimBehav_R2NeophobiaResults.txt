###################################################################
# Title: Coutts et al., Animal Behaviour, "Developmental food restriction has transient effects on neophobia and fear behaviour in zebra finches" - Round 2 Neophobia (121-126 dph)
#
# Cox Proportional Hazard Models & Kaplan-Meir Survival Curves
# using coxme and survminer packages
# Last updated: December 24, 2025
##################################################################
# for help on plots: https://cran.r-project.org/web/packages/survminer/readme/README.html

####load necessary packages
library(survival)
library(survminer)
library(coxme)

####upload data
r2neophobia=read.csv(file.choose()) #Coutts_AnimBehav_R2Neophobia.csv
r2object=read.csv(file.choose()) #Coutts_AnimBehav_R2ObjectNeophobia.csv
r2food=read.csv(file.choose()) #Coutts_AnimBehav_R2FoodNeophobia.csv
r2startle=read.csv(file.choose()) #Coutts_AnimBehav_R2StartleTest.csv

####make appropriate data types (must be numeric for survival models)
##Note: r2food = just food neophobia; r2object = just object neophobia
##Note: r2neophobia = food and objects; r2startle = startle test
r2object$Sex<-factor(r2object$Sex)                                   #sex of birds
r2food$Sex<-factor(r2food$Sex)                                       #sex of birds
r2neophobia$Sex<-factor(r2neophobia$Sex)                             #sex of birds
r2startle$Sex<-factor(r2startle$Sex)                                 #sex of birds
r2object$BirdID<-factor(r2object$BirdID)                             #subject ID
r2food$BirdID<-factor(r2food$BirdID)                                 #subject ID
r2startle$BirdID<-factor(r2startle$BirdID)                           #subject ID
r2neophobia$BirdID<-factor(r2neophobia$BirdID)                       #subject ID
r2object$TrialOrder<-as.integer(r2object$TrialOrder)                 #order trials were performed
r2food$TrialOrder<-as.integer(r2food$TrialOrder)                     #order trials were performed
r2neophobia$TrialOrder<-as.integer(r2neophobia$TrialOrder)           #order trials were performed
r2startle$TrialOrder<-as.integer(r2startle$TrialOrder)               #order trials were performed
r2object$Trial<-factor(r2object$Trial)                               #object (0=control,1=apple,2=zucchini,3=canister,4=clip)
r2food$Trial<-factor(r2food$Trial)                                   #object (0=control,1=apple,2=zucchini,3=canister,4=clip)
r2neophobia$Trial<-factor(r2neophobia$Trial)                         #object (0=control,1=apple,2=zucchini,3=canister,4=clip)
r2food$Object_noobject<-as.numeric(r2food$Object_noobject)           #was there a novel food (=1) or not (=0)
r2object$Object_noobject<-as.numeric(r2object$Object_noobject)       #was there a novel food (=1) or not (=0)
r2startle$Startle_nostartle<-as.numeric(r2startle$Startle_nostartle) #was this a startle test (=1) or control trial (=0)
r2object$Treatment<-factor(r2object$Treatment)                       #food-restricted (=1) or control (=0)
r2food$Treatment<-factor(r2food$Treatment)                           #food-restricted (=1) or control (=0)
r2neophobia$Treatment<-factor(r2neophobia$Treatment)                 #food-restricted (=1) or control (=0)
r2startle$Treatment<-factor(r2startle$Treatment)                     #food-restricted (=1) or control (=0)
r2object$TimeBowl<-as.numeric(r2object$TimeBowl)                     #time bird approached bowl
r2food$TimeBowl<-as.numeric(r2food$TimeBowl)                         #time bird approached bowl
r2neophobia$TimeBowl<-as.numeric(r2neophobia$TimeBowl)               #time bird approached bowl
r2startle$TimeBowl<-as.numeric(r2startle$TimeBowl)                   #time bird approached bowl
r2object$TimeFeed<-as.numeric(r2object$TimeFeed)                     #time fed from dish
r2food$TimeFeed<-as.numeric(r2food$TimeFeed)                         #time fed from dish
r2neophobia$TimeFeed<-as.numeric(r2neophobia$TimeFeed)               #time fed from dish
r2startle$TimeFeed<-as.numeric(r2startle$TimeFeed)                   #time fed from dish
r2object$StatusBowl<-as.numeric(r2object$StatusBowl)                         #did subject feed (=1) or not (=0)
r2food$StatusBowl<-as.numeric(r2food$StatusBowl)                             #did subject feed (=1) or not (=0)
r2neophobia$StatusBowl<-as.numeric(r2neophobia$StatusBowl)                   #did subject feed (=1) or not (=0)
r2object$StatusFeed<-as.numeric(r2object$StatusFeed)                         #did subject feed (=1) or not (=0)
r2food$StatusFeed<-as.numeric(r2food$StatusFeed)                             #did subject feed (=1) or not (=0)
r2neophobia$StatusFeed<-as.numeric(r2neophobia$StatusFeed)                   #did subject feed (=1) or not (=0)


########################
##CHECKING ASSUMPTIONS##
########################
#From: http://www.sthda.com/english/wiki/cox-model-assumptions
#Check Schoenfeld residuals to check the proportional hazards assumption 
#Do not have continuous covariates, so no need to check Martingale residuals to assess nonlinearity
#Can also check deviance residuals (symmetric transformation of the Martingale residuals), to examine influential observations
#These tests can only be used for fixed effects, not random effects

#Make a Cox model with fixed effects only
res.cox1<-coxph(Surv(TimeBowl,StatusBowl)~Trial,data=r2neophobia)
res.cox1
#Call:
#coxph(formula = Surv(TimeBowl, StatusBowl) ~ Trial, data = r2neophobia)
#
#           coef exp(coef) se(coef)      z       p
#Trial2 -0.21842   0.80379  0.19852 -1.100   0.271
#Trial3 -2.45360   0.08598  0.28544 -8.596 < 2e-16
#Trial4 -0.23652   0.78937  0.20256 -1.168   0.243
#Trial5  1.49848   4.47490  0.22061  6.792 1.1e-11
#
#Likelihood ratio test=203.2  on 4 df, p=< 2.2e-16
#n= 251, number of events= 221 

res.cox2<-coxph(Surv(TimeFeed,StatusFeed)~Trial,data=r2neophobia)
res.cox2
#Call:
#coxph(formula = Surv(TimeFeed, StatusFeed) ~ Trial, data = r2neophobia)
#
#          coef exp(coef) se(coef)      z       p
#Trial2  0.2738    1.3149   0.2104  1.301 0.19316
#Trial3 -1.9714    0.1393   0.3408 -5.784 7.3e-09
#Trial4  0.5837    1.7927   0.2122  2.751 0.00594
#Trial5  1.8738    6.5130   0.2266  8.268 < 2e-16
#
#Likelihood ratio test=175.9  on 4 df, p=< 2.2e-16
#n= 249, number of events= 198 
#   (2 observations deleted due to missingness)

res.cox3<-coxph(Surv(TimeBowl,StatusBowl)~Object_noobject,data=r2neophobia)
res.cox3
#Call:
#coxph(formula = Surv(TimeBowl, StatusBowl) ~ Object_noobject, 
#    data = r2neophobia)
#
#                   coef exp(coef) se(coef)      z      p
#Object_noobject -1.9406    0.1436   0.1931 -10.05 <2e-16
#
#Likelihood ratio test=81.73  on 1 df, p=< 2.2e-16
#n= 251, number of events= 221 

res.cox4<-coxph(Surv(TimeFeed,StatusFeed)~Object_noobject,data=r2neophobia)
res.cox4
#Call:
#coxph(formula = Surv(TimeFeed, StatusFeed) ~ Object_noobject, 
#    data = r2neophobia)
#
#                   coef exp(coef) se(coef)      z      p
#Object_noobject -1.9114    0.1479   0.1860 -10.28 <2e-16
#
#Likelihood ratio test=82.18  on 1 df, p=< 2.2e-16
#n= 249, number of events= 198 
#   (2 observations deleted due to missingness)

#Proportional hazards assumption 
#using the function cox.zph() in the survival package
test.ph1<-cox.zph(res.cox1)
test.ph1
#       chisq df    p
#Trial   6.43  4 0.17
#GLOBAL  6.43  4 0.17

test.ph2<-cox.zph(res.cox2)
test.ph2
#       chisq df    p
#Trial   7.59  4 0.11
#GLOBAL  7.59  4 0.11

test.ph3<-cox.zph(res.cox3)
test.ph3
#                chisq df   p
#Object_noobject 0.015  1 0.9
#GLOBAL          0.015  1 0.9

test.ph4<-cox.zph(res.cox4)
test.ph4
#                chisq df     p
#Object_noobject  2.85  1 0.091
#GLOBAL           2.85  1 0.091

#Checking the scaled Schoenfeld residuals against the transformed time 
#Using ggcoxzph() in the survminer package
ggcoxzph(test.ph1)
ggcoxzph(test.ph2)
ggcoxzph(test.ph3)
ggcoxzph(test.ph4)

#Checking for influential observations
#Using the function ggcoxdiagnostics() in the survminer package: 
ggcoxdiagnostics(res.cox1,type="deviance", linear.predictions=FALSE, ggtheme=theme_bw())
ggcoxdiagnostics(res.cox2,type="deviance", linear.predictions=FALSE, ggtheme=theme_bw())
ggcoxdiagnostics(res.cox3,type="deviance", linear.predictions=FALSE, ggtheme=theme_bw())
ggcoxdiagnostics(res.cox4,type="deviance", linear.predictions=FALSE, ggtheme=theme_bw())

##############################################################
##ARE OBJECTS AND NOVEL FOOD PROVIDING A NEOPHOBIC RESPONSE?##
##############################################################
object.response=coxme(Surv(TimeFeed,StatusFeed)~Object_noobject+(1|Nest/BirdID),data=r2object)
object.response
#Cox mixed-effects model fit by maximum likelihood
#  Data: r2object
#  events, n = 107, 144 (1 observation deleted due to missingness)
#  Iterations= 7 38 
#                    NULL Integrated    Fitted
#Log-likelihood -475.7269  -435.7718 -429.7895
#
#                  Chisq   df p   AIC   BIC
#Integrated loglik 79.91 3.00 0 73.91 65.89
# Penalized loglik 91.87 6.34 0 79.19 62.24
#
#Model:  Surv(TimeFeed, StatusFeed) ~ Object_noobject + (1 | Nest/BirdID) 
#Fixed coefficients
#                     coef exp(coef)  se(coef)     z p
#Object_noobject -2.263832 0.1039514 0.2447071 -9.25 0
#
#Random effects
# Group       Variable    Std Dev      Variance    
# Nest/BirdID (Intercept) 0.0198293663 0.0003932038
# Nest        (Intercept) 0.2835717272 0.0804129245
###Yes, objects are providing a neophobic response.

food.response=coxme(Surv(TimeFeed,StatusFeed)~Object_noobject+(1|Nest/BirdID),data=r2food)
food.response
#Cox mixed-effects model fit by maximum likelihood
#  Data: r2food
#  events, n = 139, 153 (1 observation deleted due to missingness)
#  Iterations= 8 45 
#                    NULL Integrated    Fitted
#Log-likelihood -594.9005  -561.3572 -535.1762
#
#                   Chisq    df          p   AIC   BIC
#Integrated loglik  67.09  3.00 1.7986e-14 61.09 52.28
# Penalized loglik 119.45 23.11 5.7732e-15 73.24  5.43
#
#Model:  Surv(TimeFeed, StatusFeed) ~ Object_noobject + (1 | Nest/BirdID) 
#Fixed coefficients
#                     coef exp(coef)  se(coef)    z       p
#Object_noobject -1.951984 0.1419921 0.2351367 -8.3 1.1e-16
#
#Random effects
# Group       Variable    Std Dev   Variance 
# Nest/BirdID (Intercept) 0.4510760 0.2034696
# Nest        (Intercept) 0.3436980 0.1181283
###Yes, novel foods are providing a neophobic response.

###########################
##TESTING FOR HABITUATION##
###########################
##Remove control trials from sheet
all.habit=coxme(Surv(TimeFeed,StatusFeed)~TrialOrder+(1|Nest/BirdID),data=r2neophobia)
all.habit
#Cox mixed-effects model fit by maximum likelihood
#  Data: r2neophobia
#  events, n = 150, 201 (2 observations deleted due to missingness)
#  Iterations= 13 55 
#                    NULL Integrated    Fitted
#Log-likelihood -716.1257  -713.1807 -707.0353
#
#                  Chisq  df         p   AIC    BIC
#Integrated loglik  5.89 3.0 0.1170900 -0.11  -9.14
# Penalized loglik 18.18 6.5 0.0081495  5.18 -14.40
#
#Model:  Surv(TimeFeed, StatusFeed) ~ TrialOrder + (1 | Nest/BirdID) 
#Fixed coefficients
#                coef exp(coef)   se(coef)    z     p
#TrialOrder 0.1127731  1.119378 0.04824647 2.34 0.019
#
#Random effects
# Group       Variable    Std Dev      Variance    
# Nest/BirdID (Intercept) 0.0195786056 0.0003833218
# Nest        (Intercept) 0.2414314013 0.0582891216
###Finches do significantly habituate to trials.

#################################################################
##EFFECT OF FOOD RESTRICTION ON NEOPHOBIA AND STARTLE BEHAVIOUR##
#################################################################
####remove control trials from files before running stats
##object neophobia, approaching the bowl
object.bowl=coxme(Surv(TimeBowl,StatusBowl)~Treatment+Trial+Sex+Sex:Treatment+(1|Nest/BirdID)+(1|TrialOrder),data=r2object)
object.bowl
#Cox mixed-effects model fit by maximum likelihood
#  Data: r2object
#  events, n = 69, 97
#  Iterations= 11 58 
#                    NULL Integrated    Fitted
#Log-likelihood -282.0644  -243.4087 -233.7956
#
#                  Chisq    df          p   AIC   BIC
#Integrated loglik 77.31  7.00 4.8628e-14 63.31 47.67
# Penalized loglik 96.54 11.51 1.5543e-15 73.52 47.81
#
#Model:  Surv(TimeBowl, StatusBowl) ~ Treatment + Trial + Sex + #Sex:Treatment +      (1 | Nest/BirdID) + (1 | TrialOrder) 
#Fixed coefficients
#                      coef  exp(coef)  se(coef)     z       p
#Treatment1      -0.5115080  0.5995907 0.4533442 -1.13 2.6e-01
#Trial4           2.7542851 15.7098054 0.3482933  7.91 2.7e-15
#SexM            -0.1500458  0.8606686 0.4133130 -0.36 7.2e-01
#Treatment1:SexM -0.1711366  0.8427065 0.5571317 -0.31 7.6e-01
#
#Random effects
# Group       Variable    Std Dev      Variance    
# Nest/BirdID (Intercept) 0.0199310826 0.0003972481
# Nest        (Intercept) 0.4506106157 0.2030499270
# TrialOrder  Intercept   0.1926684538 0.0371211331

#no interactions #####FINAL MODEL#####
object.bowl=coxme(Surv(TimeBowl,StatusBowl)~Treatment+Trial+Sex+(1|Nest/BirdID)+(1|TrialOrder),data=r2object)
object.bowl
#Cox mixed-effects model fit by maximum likelihood
#  Data: r2object
#  events, n = 69, 97
#  Iterations= 16 83 
#                    NULL Integrated    Fitted
#Log-likelihood -282.0644    -243.45 -233.3452
#
#                  Chisq    df          p   AIC   BIC
#Integrated loglik 77.23  6.00 1.3323e-14 65.23 51.82
# Penalized loglik 97.44 10.97 5.5511e-16 75.49 50.98
#
#Model:  Surv(TimeBowl, StatusBowl) ~ Treatment + Trial + Sex + (1 | #Nest/BirdID) +      (1 | TrialOrder) 
#Fixed coefficients
#                coef  exp(coef)  se(coef)     z       p
#Treatment1 -0.608457  0.5441899 0.3471982 -1.75 8.0e-02
#Trial4      2.749506 15.6349005 0.3432988  8.01 1.1e-15
#SexM       -0.246451  0.7815697 0.2756154 -0.89 3.7e-01
#
#Random effects
# Group       Variable    Std Dev      Variance    
# Nest/BirdID (Intercept) 0.0199360669 0.0003974468
# Nest        (Intercept) 0.4674263829 0.2184874234
# TrialOrder  Intercept   0.1991527956 0.0396618360

##food neophobia, approaching the bowl
food.bowl=coxme(Surv(TimeBowl,StatusBowl)~Treatment+Trial+Sex+Sex:Treatment+(1|Nest/BirdID)+(1|TrialOrder),data=r2food)
food.bowl
#Cox mixed-effects model fit by maximum likelihood
#  Data: r2food
#  events, n = 104, 106
#  Iterations= 16 67 
#                    NULL Integrated  Fitted
#Log-likelihood -390.8828  -388.7929 -383.22
#
#                  Chisq   df        p   AIC    BIC
#Integrated loglik  4.18 7.00 0.758830 -9.82 -28.33
# Penalized loglik 15.33 8.61 0.070018 -1.90 -24.68
#
#Model:  Surv(TimeBowl, StatusBowl) ~ Treatment + Trial + Sex + #Sex:Treatment +      (1 | Nest/BirdID) + (1 | TrialOrder) 
#Fixed coefficients
#                      coef exp(coef)  se(coef)     z    p
#Treatment1      -0.1598877 0.8522395 0.3323380 -0.48 0.63
#Trial2          -0.1338424 0.8747279 0.2079794 -0.64 0.52
#SexM            -0.1496579 0.8610025 0.3132083 -0.48 0.63
#Treatment1:SexM -0.1662292 0.8468521 0.4194503 -0.40 0.69
#
#Random effects
# Group       Variable    Std Dev      Variance    
# Nest/BirdID (Intercept) 0.0178128843 0.0003172988
# Nest        (Intercept) 0.2727673819 0.0744020446
# TrialOrder  Intercept   0.0530044824 0.0028094752

#no interactions #####FINAL MODEL#####
food.bowl=coxme(Surv(TimeBowl,StatusBowl)~Treatment+Trial+Sex+(1|Nest/BirdID)+(1|TrialOrder),data=r2food)
food.bowl
#Cox mixed-effects model fit by maximum likelihood
  Data: r2food
  events, n = 104, 106
  Iterations= 16 67 
                    NULL Integrated    Fitted
Log-likelihood -390.8828  -388.8711 -383.2915

                  Chisq   df        p   AIC    BIC
Integrated loglik  4.02 6.00 0.673490 -7.98 -23.84
 Penalized loglik 15.18 7.68 0.047743 -0.17 -20.47

Model:  Surv(TimeBowl, StatusBowl) ~ Treatment + Trial + Sex + (1 | Nest/BirdID) +      (1 | TrialOrder) 
Fixed coefficients
                 coef exp(coef)  se(coef)     z    p
Treatment1 -0.2488126 0.7797261 0.2427244 -1.03 0.31
Trial2     -0.1256896 0.8818885 0.2069371 -0.61 0.54
SexM       -0.2409459 0.7858841 0.2120826 -1.14 0.26

Random effects
 Group       Variable    Std Dev      Variance    
 Nest/BirdID (Intercept) 0.0178265478 0.0003177858
 Nest        (Intercept) 0.2708212472 0.0733441479
 TrialOrder  Intercept   0.0618451041 0.0038248169

##startle test, approaching the bowl
startle.bowl=coxme(Surv(TimeBowl,StatusBowl)~Treatment+Sex+Sex:Treatment+(1|Nest/BirdID),data=r2startle)
startle.bowl
#Cox mixed-effects model fit by maximum likelihood
#  Data: r2startle
#  events, n = 52, 52
#  Iterations= 6 33 
#                    NULL Integrated    Fitted
#Log-likelihood -156.3608  -155.4937 -150.6313
#
#                  Chisq   df       p   AIC    BIC
#Integrated loglik  1.73 5.00 0.88456 -8.27 -18.02
# Penalized loglik 11.46 6.96 0.11764 -2.46 -16.03
#
#Model:  Surv(TimeBowl, StatusBowl) ~ Treatment + Sex + Sex:Treatment +      #(1 | Nest/BirdID) 
#Fixed coefficients
#                      coef exp(coef)  se(coef)     z    p
#Treatment1      -0.3722422 0.6891873 0.4791291 -0.78 0.44
#SexM            -0.2075881 0.8125417 0.4663535 -0.45 0.66
#Treatment1:SexM  0.4040022 1.4978073 0.6124318  0.66 0.51
#
#Random effects
# Group       Variable    Std Dev      Variance    
# Nest/BirdID (Intercept) 0.0199622776 0.0003984925
# Nest        (Intercept) 0.3739985193 0.1398748924

#no interactions #####FINAL MODEL#####
startle.bowl=coxme(Surv(TimeBowl,StatusBowl)~Treatment+Sex+(1|Nest/BirdID),data=r2startle)
startle.bowl
Cox mixed-effects model fit by maximum likelihood
  Data: r2startle
  events, n = 52, 52
  Iterations= 5 23 
                    NULL Integrated    Fitted
Log-likelihood -156.3608  -155.7038 -150.4127

                  Chisq   df        p   AIC    BIC
Integrated loglik  1.31 4.00 0.858990 -6.69 -14.49
 Penalized loglik 11.90 6.36 0.077301 -0.83 -13.24

Model:  Surv(TimeBowl, StatusBowl) ~ Treatment + Sex + (1 | Nest/BirdID) 
Fixed coefficients
                  coef exp(coef)  se(coef)     z    p
Treatment1 -0.15114497 0.8597231 0.3534695 -0.43 0.67
SexM        0.03577014 1.0364176 0.3048210  0.12 0.91

Random effects
 Group       Variable    Std Dev      Variance    
 Nest/BirdID (Intercept) 0.0199592282 0.0003983708
 Nest        (Intercept) 0.3949875069 0.1560151306


##object neophobia, feeding
object.feed=coxme(Surv(TimeFeed,StatusFeed)~Treatment+Trial+Sex+Sex:Treatment+(1|Nest/BirdID)+(1|TrialOrder),data=r2object)
object.feed
#Cox mixed-effects model fit by maximum likelihood
#  Data: r2object
#  events, n = 59, 96 (1 observation deleted due to missingness)
#  Iterations= 6 33 
#                    NULL Integrated    Fitted
#Log-likelihood -246.0488  -205.2038 -196.7341
#
#                  Chisq    df          p   AIC   BIC
#Integrated loglik 81.69  7.00 6.2172e-15 67.69 53.15
# Penalized loglik 98.63 10.56 2.2204e-16 77.51 55.57
#
#Model:  Surv(TimeFeed, StatusFeed) ~ Treatment + Trial + Sex + #Sex:Treatment +      (1 | Nest/BirdID) + (1 | TrialOrder) 
#Fixed coefficients
#                       coef  exp(coef)  se(coef)     z       p
#Treatment1      -0.46447212  0.6284668 0.4845009 -0.96 3.4e-01
#Trial4           3.08197051 21.8013198 0.4008664  7.69 1.5e-14
#SexM            -0.01594431  0.9841821 0.4381986 -0.04 9.7e-01
#Treatment1:SexM  0.21762870  1.2431254 0.5883625  0.37 7.1e-01
#
#Random effects
# Group       Variable    Std Dev      Variance    
# Nest/BirdID (Intercept) 0.1006083977 0.0101220497
# Nest        (Intercept) 0.4800849711 0.2304815795
# TrialOrder  Intercept   0.0198462397 0.0003938732

#no interactions ######FINAL MODEL########
object.feed=coxme(Surv(TimeFeed,StatusFeed)~Treatment+Trial+Sex+(1|Nest/BirdID)+(1|TrialOrder),data=r2object)
object.feed
#Cox mixed-effects model fit by maximum likelihood
  Data: r2object
  events, n = 59, 96 (1 observation deleted due to missingness)
  Iterations= 18 93 
                    NULL Integrated    Fitted
Log-likelihood -246.0488  -205.2568 -194.8542

                   Chisq    df          p   AIC   BIC
Integrated loglik  81.58  6.00 1.6653e-15 69.58 57.12
 Penalized loglik 102.39 11.44 1.1102e-16 79.52 55.76

Model:  Surv(TimeFeed, StatusFeed) ~ Treatment + Trial + Sex + (1 | Nest/BirdID) +      (1 | TrialOrder) 
Fixed coefficients
                 coef  exp(coef)  se(coef)     z       p
Treatment1 -0.3345771  0.7156407 0.3674580 -0.91 3.6e-01
Trial4      3.1444514 23.2069402 0.4046486  7.77 7.8e-15
SexM        0.1171662  1.1243062 0.3042412  0.39 7.0e-01

Random effects
 Group       Variable    Std Dev      Variance    
 Nest/BirdID (Intercept) 2.547895e-01 6.491768e-02
 Nest        (Intercept) 4.667920e-01 2.178948e-01
 TrialOrder  Intercept   8.598211e-03 7.392923e-05

##food neophobia, feeding
food.feed=coxme(Surv(TimeFeed,StatusFeed)~Treatment+Trial+Sex+Sex:Treatment+(1|Nest/BirdID)+(1|TrialOrder),data=r2food)
food.feed
#Cox mixed-effects model fit by maximum likelihood
#  Data: r2food
#  events, n = 91, 105 (1 observation deleted due to missingness)
#  Iterations= 29 123 
#                    NULL Integrated    Fitted
#Log-likelihood -361.7213   -355.538 -316.0993
#
#                  Chisq    df          p   AIC    BIC
#Integrated loglik 12.37  7.00 8.9126e-02 -1.63 -19.21
# Penalized loglik 91.24 33.18 2.5311e-07 24.89 -58.41
#
#Model:  Surv(TimeFeed, StatusFeed) ~ Treatment + Trial + Sex + #Sex:Treatment +      (1 | Nest/BirdID) + (1 | TrialOrder) 
#Fixed coefficients
#                      coef exp(coef)  se(coef)     z    p
#Treatment1      -0.3710547 0.6900062 0.5281096 -0.70 0.48
#Trial2           0.3632247 1.4379590 0.2446963  1.48 0.14
#SexM            -0.2784854 0.7569294 0.4607817 -0.60 0.55
#Treatment1:SexM  0.0303687 1.0308345 0.6345132  0.05 0.96
#
#Random effects
# Group       Variable    Std Dev    Variance  
# Nest/BirdID (Intercept) 0.77102549 0.59448030
# Nest        (Intercept) 0.54582439 0.29792427
# TrialOrder  Intercept   0.22399686 0.05017459

#no interactions ########FINAL MODEL########
food.feed=coxme(Surv(TimeFeed,StatusFeed)~Treatment+Trial+Sex+(1|Nest/BirdID)+(1|TrialOrder),data=r2food)
food.feed
#Cox mixed-effects model fit by maximum likelihood
#  Data: r2food
#  events, n = 91, 105 (1 observation deleted due to missingness)
#  Iterations= 17 75 
#                    NULL Integrated   Fitted
#Log-likelihood -361.7213  -355.5384 -316.033
#
#                  Chisq    df          p   AIC    BIC
#Integrated loglik 12.37  6.00 5.4286e-02  0.37 -14.70
# Penalized loglik 91.38 32.75 1.9250e-07 25.87 -56.36
#
#Model:  Surv(TimeFeed, StatusFeed) ~ Treatment + Trial + Sex + (1 | #Nest/BirdID) +      (1 | TrialOrder) 
#Fixed coefficients
#                 coef exp(coef)  se(coef)     z    p
#Treatment1 -0.3550368 0.7011476 0.4044652 -0.88 0.38
#Trial2      0.3631912 1.4379108 0.2445767  1.48 0.14
#SexM       -0.2628425 0.7688630 0.3190988 -0.82 0.41
#
#Random effects
# Group       Variable    Std Dev    Variance  
# Nest/BirdID (Intercept) 0.77321936 0.59786818
# Nest        (Intercept) 0.54322559 0.29509404
# TrialOrder  Intercept   0.22512023 0.05067912

##startle test, feeding
startle.feed=coxme(Surv(TimeFeed,StatusFeed)~Treatment+Sex+Sex:Treatment+(1|Nest/BirdID),data=r2startle)
startle.feed
#Cox mixed-effects model fit by maximum likelihood
#  Data: r2startle
#  events, n = 51, 52
#  Iterations= 19 100 
#                    NULL Integrated    Fitted
#Log-likelihood -156.3608  -147.1763 -126.4844
#
#                  Chisq    df          p   AIC   BIC
#Integrated loglik 18.37  5.00 2.5177e-03  8.37 -1.29
# Penalized loglik 59.75 15.46 3.8922e-07 28.84 -1.02
#
#Model:  Surv(TimeFeed, StatusFeed) ~ Treatment + Sex + Sex:Treatment +      (1 | Nest/BirdID) 
#Fixed coefficients
#                      coef exp(coef)  se(coef)     z     p
#Treatment1      -0.9286784 0.3950755 0.8242998 -1.13 0.260
#SexM             0.1583188 1.1715397 0.5436154  0.29 0.770
#Treatment1:SexM  1.3988202 4.0504185 0.7567250  1.85 0.065
#
#Random effects
# Group       Variable    Std Dev      Variance    
# Nest/BirdID (Intercept) 0.0199758966 0.0003990364
# Nest        (Intercept) 1.3223557238 1.7486246603

##########
##GRAPHS##
##########
fit.object.bowl<-survfit(Surv(TimeBowl,StatusBowl)~Treatment,data=r2object)
ggsurvplot(fit.object.bowl,
           data=r2object,
           size=0.5, #change line size
           palette = c("#0004FF","#FF0008"), #custom colour
           conf.int = TRUE, #add confidence interval
           #conf.int.style = "ribbon", #"ribbon or "step"
           #conf.int.alpha = 0.3, #0 = transparent & 1 = not transparent
           pval=FALSE, #add p-value
           pval.coord=c(2700,0.9), #change position of p-value
           legend.labs = c("Control","Food-restricted"), #change legend labels
           legend.title = "Treatment",
           xlab = "Time (seconds)", #change x-axis label
           ylab = "Proportion yet to feed", #change y-axis label
           break.time.by = 300,
           ggtheme = theme_bw() #change ggplot theme
)

fit.object.feed<-survfit(Surv(TimeFeed,StatusFeed)~Treatment,data=r2object)
ggsurvplot(fit.object.feed,
           data=r2object,
           size=0.5, #change line size
           palette = c("#0004FF","#FF0008"), #custom colour
           conf.int = TRUE, #add confidence interval
           #conf.int.style = "ribbon", #"ribbon or "step"
           #conf.int.alpha = 0.3, #0 = transparent & 1 = not transparent
           pval=FALSE, #add p-value
           pval.coord=c(2700,0.9), #change position of p-value
           legend.labs = c("Control","Food-restricted"), #change legend labels
           legend.title = "Treatment",
           xlab = "Time (seconds)", #change x-axis label
           ylab = "Proportion yet to feed", #change y-axis label
           break.time.by = 300,
           ggtheme = theme_bw() #change ggplot theme
)

fit.food.bowl<-survfit(Surv(TimeBowl,StatusBowl)~Treatment,data=r2food)
ggsurvplot(fit.food.bowl,
           data=r2food,
           size=0.5, #change line size
           palette = c("#0004FF","#FF0008"), #custom colour
           conf.int = TRUE, #add confidence interval
           #conf.int.style = "ribbon", #"ribbon or "step"
           #conf.int.alpha = 0.3, #0 = transparent & 1 = not transparent
           pval=FALSE, #add p-value
           pval.coord=c(2700,0.9), #change position of p-value
           legend.labs = c("Control","Food-restricted"), #change legend labels
           legend.title = "Treatment",
           xlab = "Time (seconds)", #change x-axis label
           ylab = "Proportion yet to approach bowl", #change y-axis label
           break.time.by = 300,
           ggtheme = theme_bw() #change ggplot theme
)

fit.food.feed<-survfit(Surv(TimeFeed,StatusFeed)~Treatment,data=r2food)
ggsurvplot(fit.food.feed,
           data=r2food,
           size=0.5, #change line size
           palette = c("#0004FF","#FF0008"), #custom colour
           conf.int = TRUE, #add confidence interval
           #conf.int.style = "ribbon", #"ribbon or "step"
           #conf.int.alpha = 0.3, #0 = transparent & 1 = not transparent
           pval=FALSE, #add p-value
           pval.coord=c(2700,0.9), #change position of p-value
           legend.labs = c("Control","Food-restricted"), #change legend labels
           legend.title = "Treatment",
           xlab = "Time (seconds)", #change x-axis label
           ylab = "Proportion yet to feed", #change y-axis label
           break.time.by = 300,
           ggtheme = theme_bw() #change ggplot theme
)

fit.startle.bowl<-survfit(Surv(TimeBowl,StatusBowl)~Treatment,data=r2startle)
ggsurvplot(fit.startle.bowl,
           data=r2startle,
           size=0.5, #change line size
           palette = c("#0004FF","#FF0008"), #custom colour
           conf.int = TRUE, #add confidence interval
           #conf.int.style = "ribbon", #"ribbon or "step"
           #conf.int.alpha = 0.3, #0 = transparent & 1 = not transparent
           pval=FALSE, #add p-value
           pval.coord=c(2700,0.9), #change position of p-value
           legend.labs = c("Control","Food-restricted"), #change legend labels
           legend.title = "Treatment",
           xlab = "Time (seconds)", #change x-axis label
           ylab = "Proportion yet to approach bowl", #change y-axis label
           break.time.by = 300,
           ggtheme = theme_bw() #change ggplot theme
)

fit.startle.feed<-survfit(Surv(TimeFeed,StatusFeed)~Treatment,data=r2startle)
ggsurvplot(fit.startle.feed,
           data=r2startle,
           size=0.5, #change line size
           palette = c("#0004FF","#FF0008"), #custom colour
           conf.int = TRUE, #add confidence interval
           #conf.int.style = "ribbon", #"ribbon or "step"
           #conf.int.alpha = 0.3, #0 = transparent & 1 = not transparent
           pval=FALSE, #add p-value
           pval.coord=c(2700,0.9), #change position of p-value
           legend.labs = c("Control","Food-restricted"), #change legend labels
           legend.title = "Treatment",
           xlab = "Time (seconds)", #change x-axis label
           ylab = "Proportion yet to feed", #change y-axis label
           break.time.by = 60,
           ggtheme = theme_bw() #change ggplot theme
)


